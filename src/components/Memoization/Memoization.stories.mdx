import { Meta, Story, Preview } from "@storybook/addon-docs/blocks";
import LoadingImages from "../LoadingImages";

import Memoization from "./Memoization";

<Meta title="Memoization" component={Memoization} />

# Memoization

In other words: caching components and functions.

[Loading data](./?path=/docs/loading-data--default-values-as-placeholders-loading-state) and [images](./?path=/docs/loading-images--art-direction-with-cloudinary) leverages the power of caching using third party solutions. For components and functions we have built-in mechanism provided by React out of the box: `React.memo()` and `useMemo()`, `useCallback()`.

## Caching components

If a component:

1. Is functional (ie. renders something)
2. Is pure (ie. given the same props always renders the same output)
3. Usually takes the same props when re-rendering
4. Renders often
5. Has medium to big size

then it can be wrapped into `React.memo()` and it will be cached.

In fact any component can be memoized but those not satisfying the conditions above [might do more harm than good](https://dmitripavlutin.com/use-react-memo-wisely/).

### Measure first

A good starting point to see which component might need memoization is to use the [React profiler](https://reactjs.org/docs/optimizing-performance.html#profiling-components-with-the-chrome-performance-tab)

<LoadingImages
  images={false}
  src="memoization-1.png"
  alt="The React profiler"
/>

`Repeat`, `Meta` and `TypographicGrid` are components specific to this app and can be memoized.

Before memoization their loading times were:

```
| Component       | Loading time (ms)                         |
|-----------------|-------------------------------------------|
|                 | 1st load | 2nd load | 3rd load | 4th load |
|-------------------------------------------------------------|
| Repeat          | 3.7, 3.1 | 4.0, 3.8 | 13 , 2.6 | 4.2, 2.6 |
| Meta            | 0.8      | 1.4      | 1        | 1.3      |
| TypographicGrid | 0.7      | 0.8      | 4.5      | 0.8      |
```

Memoizing them brings in the following results:

```
| Component       | Loading time (ms)                         |
|-----------------|-------------------------------------------|
|                 | 1st load | 2nd load | 3rd load | 4th load |
|-------------------------------------------------------------|
| Repeat          | 2.5, 2.4 | 3.1, 3.1 | 6.5, 3.1 | 3.5, 2.2 |
| Meta            | 0.9      | 1.1      | 0.9      | 1.4      |
| TypographicGrid | 1.8      | 0.8      | 1        | 0.7      |
```

## Resources

- [Use React.memo() wisely](https://dmitripavlutin.com/use-react-memo-wisely/)
