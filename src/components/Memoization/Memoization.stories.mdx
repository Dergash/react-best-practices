import { Meta, Story, Preview } from "@storybook/addon-docs/blocks";
import LoadingImages from "../LoadingImages";

import Memoization from "./Memoization";

<Meta title="Memoization" component={Memoization} />

# Memoization

In other words: caching components and functions.

[Loading data](./?path=/docs/loading-data--default-values-as-placeholders-loading-state) and [images](./?path=/docs/loading-images--art-direction-with-cloudinary) leverages the power of caching using third party solutions. For components and functions we have built-in mechanism provided by React out of the box: `React.memo()` and `useMemo()`, `useCallback()`.

## Caching components

Introduced rencently `React.memo()`:

> Bails out components from rendering when their input props are the same

That makes one think why don't memoize every component? The answer is: [avoid premature optimizations](./?path=/docs/memoization--storybookdocsonly). React is fast enough and every code added in plus might cause more harm than benefit.

### Measure first

A good starting point to see which component might need memoization is to use the React profiler.

<LoadingImages
  images={false}
  src="memoization-1.png"
  alt="The React profiler"
/>

`Repeat`, `Meta` and `TypographicGrid` are the components specific to this app &mdash; written by hand &mdash; which are the most time consuming among their peers.

Their loading times are:

```
| Component       | Loading time (ms)                         | Average |
|-----------------|-------------------------------------------|---------|
|                 | 1st load | 2nd load | 3rd load | 4th load |         |
|-------------------------------------------------------------|---------|
| Repeat          | 3.7, 3.1 | 4.0, 3.8 | 13 , 2.6 | 4.2, 2.6 | 4.625   |
| Meta            | 0.8      | 1.4      | 1        | 1.3      | 1.125   |
| TypographicGrid | 0.7      | 0.8      | 4.5      | 0.8      | 1.7     |
```

Memoizing them brings in the following results:

```
| Component       | Loading time (ms)                         | Average |
|-----------------|-------------------------------------------|---------|
|                 | 1st load | 2nd load | 3rd load | 4th load |         |
|-------------------------------------------------------------|---------|
| Repeat          | 2.5, 2.4 | 3.1, 3.1 | 6.5, 3.1 | 3.5, 2.2 | 3.3     |
| Meta            | 0.9      | 1.1      | 0.9      | 1.4      | 1.075   |
| TypographicGrid | 1.8      | 0.8      | 1        | 0.7      | 1.075   |
```

It seems they all worth memoized in this context. However this feature needs more reasearch.

## Resources

- [React v16.6.0: lazy, memo and contextType](https://reactjs.org/blog/2018/10/23/react-v-16-6.html)
